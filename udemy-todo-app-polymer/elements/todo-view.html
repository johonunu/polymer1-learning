<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<!-- Add your elements here -->
<link rel="import" href="todo-list.html">
<link rel="import" href="todo-input.html">

<dom-module id="todo-view">
  <template>
    <div class="layout horizontal">
      <div class="flex-3"></div>
      <div class="flex-3">
        <div class="input-wrapper">
          <paper-input value="{{query}}"
                       label="Search">
          </paper-input>
        </div>
        <h3>- To Do's</h3>
        <todo-list todos="{{todos}}" filter-by="uncompleted" query="{{query}}" hide-archive></todo-list>
        <div class="layout horizontal" hidden="{{hideCompletedTodos}}">
          <div class="flex-8">
            <hr/>
          </div>
          <div class="flex-4">
            <paper-button on-tap="_archiveAll">Archive All</paper-button>
          </div>
        </div>
        <h3 hidden="{{hideCompletedTodos}}">- Completed To Do's</h3>
        <todo-list todos="{{todos}}" filter-by="completed" query="{{query}}"
                   hidden="{{hideCompletedTodos}}" hide-archive></todo-list>
      </div>
      <div class="flex-3">
        <todo-input on-add-todo="_addTodo"></todo-input>
      </div>
      <div class="flex-3"></div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'todo-view',
      properties: {
        todos: Array
      },
      observers: [
        '_calcHideCompletedTodos(todos.*)'
      ],
      hideCompletedTodos: Boolean,
      _addTodo: function (e) {
        this.push('todos', {
          name: e.detail.value,
          done: false,
          archive: false
        });
      },
      _calcHideCompletedTodos: function () {
        // find first element property done is treu its means completed element exists
        this.hideCompletedTodos = !_.find(this.todos, function (item) {
          return item.done && !item.archive;
        });
      },
      _archiveAll: function () {
        var _this = this;
        _.each(this.todos, function (item, index) {
          if (item.done) {
            _this.set('todos.' + index + '.archive', true);
          }
        });
        this._calcHideCompletedTodos();
      }
    });
  </script>
</dom-module>